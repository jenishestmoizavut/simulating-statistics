<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Law of Large Numbers: Interactive</title>
    <style>
        :root {
            --bg-color: #222f3e;
            --accent: #48dbfb; /* Cyan */
            --tails: #ff6b6b;  /* Reddish */
            --heads: #feca57;  /* Yellowish */
            --text-color: #c8d6e5;
            --container-bg: #151b23;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, monospace;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }

        h1 { margin-bottom: 5px; font-weight: 300; letter-spacing: 2px; text-transform: uppercase; color: #fff; }
        
        /* Insight Box */
        .insight-box {
            background: rgba(72, 219, 251, 0.1);
            border-left: 4px solid var(--accent);
            padding: 10px 20px;
            margin-bottom: 20px;
            max-width: 600px;
            border-radius: 4px;
            min-height: 40px;
            display: flex; align-items: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        .insight-text { font-size: 0.95rem; line-height: 1.4; color: #fff; }

        /* Coin & Ticker Area */
        .interaction-area {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 20px;
        }

        .coin-display {
            width: 90px; height: 90px;
            border-radius: 50%;
            background: #dfe6e9;
            color: #2d3436;
            display: flex; align-items: center; justify-content: center;
            font-size: 1.8rem; font-weight: bold;
            border: 5px solid #b2bec3;
            box-shadow: 0 0 25px rgba(0,0,0,0.4);
            cursor: pointer; 
            user-select: none;
            transition: all 0.1s;
            position: relative;
        }
        .coin-display:hover { transform: translateY(-2px); box-shadow: 0 5px 30px rgba(0,0,0,0.5); }
        .coin-display:active { transform: scale(0.95); }
        .coin-display.heads { background: var(--heads); border-color: #f1c40f; color: #7f6000; }
        .coin-display.tails { background: var(--tails); border-color: #ee5253; color: #690808; }

        /* Ticker Tape */
        .ticker-container {
            width: 200px;
            height: 50px;
            background: rgba(0,0,0,0.3);
            border-radius: 8px;
            overflow: hidden;
            position: relative;
            display: flex;
            align-items: center;
            padding: 0 10px;
            box-shadow: inset 0 0 10px rgba(0,0,0,0.5);
        }
        .ticker-tape {
            display: flex;
            gap: 10px;
            flex-direction: row-reverse; /* Newest items on left */
            width: 100%;
            justify-content: flex-end;
        }
        .ticker-item {
            width: 30px; height: 30px;
            border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-weight: bold; font-size: 0.8rem;
            flex-shrink: 0;
            opacity: 0;
            animation: popIn 0.3s forwards;
        }
        @keyframes popIn { from { transform: scale(0); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        .t-head { background: var(--heads); color: #333; }
        .t-tail { background: var(--tails); color: #fff; }

        /* Chart */
        .chart-wrapper {
            position: relative;
            width: 100%; max-width: 700px;
            height: 300px;
            background: var(--container-bg);
            border: 1px solid #576574;
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        canvas { display: block; width: 100%; height: 100%; border-radius: 12px; }
        .target-line-label { position: absolute; right: 10px; top: 46%; font-size: 0.7rem; color: #ff9f43; background: rgba(0,0,0,0.8); padding: 2px 5px; border-radius: 4px; }

        /* Controls */
        .controls {
            display: flex; gap: 15px; margin-bottom: 20px;
            background: rgba(255,255,255,0.05); padding: 15px 25px;
            border-radius: 50px; align-items: center; flex-wrap: wrap; justify-content: center;
        }

        button {
            padding: 10px 24px; border-radius: 25px; border: none;
            font-size: 0.9rem; font-weight: 700; cursor: pointer;
            transition: all 0.2s; background: #576574; color: white;
            display: flex; align-items: center; gap: 8px;
        }
        button:hover { background: #677685; }
        button:active { transform: scale(0.95); }
        button.primary { background-color: var(--accent); color: #222f3e; }
        button.primary:hover { background-color: #3dc1e3; }
        button.stop { background-color: #ff6b6b; color: white; }

        .slide-container { display: flex; align-items: center; gap: 10px; font-size: 0.8rem; font-weight: bold; border-left: 1px solid rgba(255,255,255,0.2); padding-left: 15px; margin-left: 5px; }
        input[type=range] { accent-color: var(--accent); width: 120px; cursor: pointer; }

        .sound-toggle {
            background: transparent; border: 1px solid rgba(255,255,255,0.3); padding: 8px 12px;
        }
        .sound-toggle.muted { opacity: 0.5; text-decoration: line-through; }

        /* Stats */
        .stats-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; width: 100%; max-width: 600px; }
        .stat-card { background: rgba(0,0,0,0.2); padding: 15px; border-radius: 12px; text-align: center; border: 1px solid rgba(255,255,255,0.05); }
        .stat-card h3 { margin: 0 0 5px 0; font-size: 0.75rem; color: #8395a7; text-transform: uppercase; }
        .stat-card .value { font-size: 1.3rem; font-weight: bold; font-family: monospace; }
        .highlight-green { color: #1dd1a1; text-shadow: 0 0 10px rgba(29, 209, 161, 0.4); }

    </style>
</head>
<body>

    <h1>Law of Large Numbers</h1>
    
    <div class="insight-box">
        <span class="insight-text" id="insightText">Tap the coin to flip! Watch how individual chaos creates a pattern.</span>
    </div>

    <div class="interaction-area">
        <div class="coin-display" id="coin" onclick="manualFlip()">FLIP</div>
        
        <div class="ticker-container">
            <div class="ticker-tape" id="tickerTape">
                </div>
        </div>
    </div>

    <div class="chart-wrapper">
        <canvas id="chart"></canvas>
        <div class="target-line-label">Target: 50%</div>
    </div>

    <div class="controls">
        <button id="btnStart" class="primary" onclick="toggleSim()">
            <span>‚ñ∂ Run Auto</span>
        </button>
        
        <div class="slide-container">
            <span>SPEED</span>
            <input type="range" id="speedRange" min="1" max="50" value="2">
        </div>

        <button class="sound-toggle" id="btnSound" onclick="toggleSound()">üîä</button>
        <button onclick="resetSim()">‚Ü∫ Reset</button>
    </div>

    <div class="stats-grid">
        <div class="stat-card">
            <h3>Total Flips</h3>
            <div class="value" id="totalEl">0</div>
        </div>
        <div class="stat-card">
            <h3>Heads</h3>
            <div class="value" id="headsEl">0</div>
        </div>
        <div class="stat-card">
            <h3>Heads %</h3>
            <div class="value" id="ratioEl">0.0%</div>
        </div>
    </div>

    <script>
        // --- AUDIO ENGINE (Synthesized sounds) ---
        const AudioContext = window.AudioContext || window.webkitAudioContext;
        let audioCtx = new AudioContext();
        let soundEnabled = true;

        function playTone(freq, type = 'sine', duration = 0.1) {
            if (!soundEnabled) return;
            if (audioCtx.state === 'suspended') audioCtx.resume();

            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();

            osc.type = type;
            osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
            
            gain.gain.setValueAtTime(0.05, audioCtx.currentTime); // Low volume
            gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + duration);

            osc.connect(gain);
            gain.connect(audioCtx.destination);
            
            osc.start();
            osc.stop(audioCtx.currentTime + duration);
        }

        function playFlipSound(isHeads) {
            // High pitch for Heads, lower for Tails
            if (parseInt(document.getElementById('speedRange').value) > 5 && isRunning) return; // Don't play sound at high speed
            
            if (isHeads) playTone(800, 'triangle', 0.1); 
            else playTone(600, 'triangle', 0.1);
        }

        function playMilestoneSound() {
            if (!soundEnabled) return;
            // A pleasant chord
            playTone(440, 'sine', 0.3);
            setTimeout(() => playTone(554, 'sine', 0.3), 100);
            setTimeout(() => playTone(659, 'sine', 0.3), 200);
        }

        function toggleSound() {
            soundEnabled = !soundEnabled;
            const btn = document.getElementById('btnSound');
            btn.innerHTML = soundEnabled ? "üîä" : "üîá";
            btn.classList.toggle('muted', !soundEnabled);
        }

        // --- SIMULATION LOGIC ---
        const canvas = document.getElementById('chart');
        const ctx = canvas.getContext('2d');
        const coinEl = document.getElementById('coin');
        const totalEl = document.getElementById('totalEl');
        const headsEl = document.getElementById('headsEl');
        const ratioEl = document.getElementById('ratioEl');
        const tickerEl = document.getElementById('tickerTape');
        const insightEl = document.getElementById('insightText');
        const speedRange = document.getElementById('speedRange');

        let isRunning = false;
        let animationFrame;
        let total = 0;
        let heads = 0;
        let history = []; 

        function init() {
            const dpr = window.devicePixelRatio || 1;
            const rect = canvas.getBoundingClientRect();
            canvas.width = rect.width * dpr;
            canvas.height = rect.height * dpr;
            ctx.scale(dpr, dpr);
            resetSim();
        }

        function resetSim() {
            isRunning = false;
            cancelAnimationFrame(animationFrame);
            document.getElementById('btnStart').innerHTML = "<span>‚ñ∂ Run Auto</span>";
            document.getElementById('btnStart').className = "primary";
            
            total = 0;
            heads = 0;
            history = [];
            tickerEl.innerHTML = "";
            
            coinEl.className = "coin-display";
            coinEl.innerText = "FLIP";
            
            updateStats();
            drawChart();
            updateInsight();
        }

        function manualFlip() {
            if (isRunning) toggleSim(); 
            // Manual flips always show animation and sound
            flip(true); 
            updateStats();
            drawChart();
        }

        function flip(forceVisual = false) {
            const isHeads = Math.random() > 0.5;
            total++;
            if (isHeads) heads++;
            
            playFlipSound(isHeads);

            // Visual Updates (Coin & Ticker)
            // We throttle visual updates if speed is super high to save CPU
            const speed = parseInt(speedRange.value);
            if (forceVisual || speed < 10) {
                // 1. Animate Coin
                coinEl.className = isHeads ? "coin-display heads" : "coin-display tails";
                coinEl.innerText = isHeads ? "H" : "T";
                coinEl.style.transform = "scale(0.9)";
                setTimeout(() => coinEl.style.transform = "scale(1)", 50);

                // 2. Update Ticker Tape
                const tick = document.createElement('div');
                tick.className = isHeads ? "ticker-item t-head" : "ticker-item t-tail";
                tick.innerText = isHeads ? "H" : "T";
                tickerEl.prepend(tick);
                if (tickerEl.children.length > 8) tickerEl.lastElementChild.remove();
            }

            // Milestone Sound
            if (total === 100 || total === 1000 || total === 10000) playMilestoneSound();

            // Data History
            // Optimization: Keep array size manageable for rendering
            if (total < 2000 || total % 5 === 0) {
                history.push(heads / total);
            }
        }

        function updateInsight() {
            let msg = "";
            const ratio = total > 0 ? heads/total : 0;
            const dist = Math.abs(ratio - 0.5);

            if (total === 0) msg = "Tap the coin or click 'Run Auto' to start the experiment.";
            else if (total < 10) msg = "<strong>Small Sample Size:</strong> Notice the wild swings? With few flips, luck dominates math.";
            else if (total < 100) msg = "<strong>High Volatility:</strong> The line is still jagged. We are adding data, but randomness is still visible.";
            else if (total < 1000) msg = "<strong>Stabilizing:</strong> Notice how the line is getting pulled toward the center (50%)? That is the Law of Large Numbers.";
            else if (dist < 0.01) msg = "<strong>Convergence!</strong> With " + total.toLocaleString() + " flips, we are incredibly close to the theoretical 50%.";
            else msg = "<strong>Long Run:</strong> Even with minor fluctuations, the accumulated data forces the average towards the expected probability.";

            insightEl.innerHTML = msg;
        }

        function updateStats() {
            totalEl.innerText = total.toLocaleString();
            headsEl.innerText = heads.toLocaleString();

            const percent = total === 0 ? 0 : (heads / total * 100).toFixed(1);
            ratioEl.innerText = percent + "%";
            
            // Color code the percentage if it's close to 50%
            const diff = Math.abs((heads/total) - 0.5);
            if (total > 50 && diff < 0.01) ratioEl.className = "value highlight-green";
            else ratioEl.className = "value";

            // Update text explanation every 10 frames or on manual click
            if (!isRunning || total % 10 === 0) updateInsight();
        }

        function drawChart() {
            const width = canvas.width / (window.devicePixelRatio || 1);
            const height = canvas.height / (window.devicePixelRatio || 1);
            
            ctx.clearRect(0, 0, width, height);
            
            // Grid
            ctx.strokeStyle = "rgba(255, 255, 255, 0.05)";
            ctx.lineWidth = 1;
            ctx.beginPath(); ctx.moveTo(0, height*0.25); ctx.lineTo(width, height*0.25); ctx.stroke();
            ctx.beginPath(); ctx.moveTo(0, height*0.75); ctx.lineTo(width, height*0.75); ctx.stroke();

            // Target Line 50%
            const targetY = height / 2;
            ctx.strokeStyle = "#ff9f43";
            ctx.lineWidth = 2;
            ctx.setLineDash([5, 5]); 
            ctx.beginPath(); ctx.moveTo(0, targetY); ctx.lineTo(width, targetY); ctx.stroke();
            ctx.setLineDash([]);

            if (history.length < 2) return;

            const stepX = width / (history.length - 1);
            
            ctx.beginPath();
            for (let i = 0; i < history.length; i++) {
                const y = height - (history[i] * height);
                if (i === 0) ctx.moveTo(0, y);
                else ctx.lineTo(i * stepX, y);
            }
            
            ctx.lineJoin = 'round';
            ctx.lineWidth = 2;
            ctx.strokeStyle = "#48dbfb";
            ctx.stroke();

            // Glow under graph
            ctx.lineTo(width, height);
            ctx.lineTo(0, height);
            ctx.closePath();
            const grad = ctx.createLinearGradient(0,0,0,height);
            grad.addColorStop(0, "rgba(72, 219, 251, 0.2)");
            grad.addColorStop(1, "rgba(72, 219, 251, 0)");
            ctx.fillStyle = grad;
            ctx.fill();
        }

        function toggleSim() {
            if (isRunning) {
                isRunning = false;
                document.getElementById('btnStart').innerHTML = "<span>‚ñ∂ Run Auto</span>";
                document.getElementById('btnStart').className = "primary";
            } else {
                if (audioCtx.state === 'suspended') audioCtx.resume();
                isRunning = true;
                document.getElementById('btnStart').innerHTML = "<span>‚ùö‚ùö Pause</span>";
                document.getElementById('btnStart').className = "stop"; 
                loop();
            }
        }

        function loop() {
            if (!isRunning) return;

            // Speed logic: 
            // Low slider = 1 flip per frame
            // High slider = many flips per frame
            const val = parseInt(speedRange.value);
            const loops = val === 1 ? 1 : Math.ceil(Math.pow(val, 1.8) / 10);
            
            // Artificial delay for very slow speeds (1 or 2) to make it readable
            if (val <= 3 && total % (5-val) !== 0) {
                 // skip frame to slow down
            } else {
                for (let i = 0; i < loops; i++) {
                    flip();
                }
                updateStats();
                drawChart();
            }
            
            animationFrame = requestAnimationFrame(loop);
        }

        window.addEventListener('resize', init);
        init();

    </script>
</body>
</html>

