<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Monty Hall Simulator</title>
    <link rel="icon" href="../favicon.ico">
    <style>
        :root {
            --bg-color: #222f3e;
            --door-color: #ff9f43;
            --door-hover: #ffb166;
            --accent: #48dbfb;
            --text-color: #c8d6e5;
            --container-bg: #151b23;
            --success: #1dd1a1;
            --danger: #ff6b6b;
            --info: #54a0ff;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0; padding: 20px;
            display: flex; flex-direction: column; align-items: center;
            min-height: 100vh;
        }

        h1 { margin-bottom: 5px; font-weight: 300; letter-spacing: 2px; text-transform: uppercase; color: #fff; text-align: center; }
        p.subtitle { color: #8395a7; margin-top: 0; margin-bottom: 30px; text-align: center; }

        /* --- DOORS --- */
        .game-container {
            display: flex; gap: 20px; margin-bottom: 40px; perspective: 1000px; justify-content: center;
        }

        .door-wrapper {
            position: relative; width: 100px; height: 150px; cursor: pointer;
        }

        .door {
            width: 100%; height: 100%;
            background-color: var(--door-color);
            border-radius: 8px;
            position: absolute; top: 0; left: 0; z-index: 2;
            transition: transform 0.5s ease-in-out, background-color 0.2s;
            transform-origin: left;
            display: flex; align-items: center; justify-content: center;
            font-size: 2rem; color: rgba(0,0,0,0.2); font-weight: bold;
            border: 4px solid #e58e26;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        .door-wrapper:hover .door { background-color: var(--door-hover); }
        .door-wrapper.selected .door { border-color: var(--accent); box-shadow: 0 0 20px var(--accent); }
        .door-wrapper.open .door { transform: rotateY(-110deg); }

        .prize {
            width: 100%; height: 100%;
            background-color: #2d3436;
            border-radius: 8px;
            position: absolute; top: 0; left: 0; z-index: 1;
            display: flex; align-items: center; justify-content: center;
            font-size: 3.5rem;
            box-shadow: inset 0 0 20px rgba(0,0,0,0.5);
        }

        /* --- CONTROLS --- */
        .message-box {
            height: 40px; margin-bottom: 20px; font-size: 1.2rem; font-weight: 600;
            color: var(--accent); text-align: center;
        }

        .controls {
            display: flex; gap: 15px; margin-bottom: 30px; flex-wrap: wrap; justify-content: center;
        }

        button {
            padding: 12px 25px; border-radius: 25px; border: none; font-size: 1rem; font-weight: 700;
            cursor: pointer; transition: transform 0.1s, background 0.2s;
            background: #576574; color: white;
        }
        button:hover { background: #6c7a89; }
        button:active { transform: scale(0.95); }
        
        button.choice { background-color: var(--accent); color: #222f3e; display: none; }
        button.sim { background-color: var(--info); color: white; }
        
        .icon-btn { width: 45px; height: 45px; padding: 0; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.2rem; }

        /* --- STATS BARS --- */
        .stats-grid {
            background: var(--container-bg); padding: 25px; border-radius: 15px;
            border: 1px solid #576574; width: 100%; max-width: 500px;
        }

        .stat-row { margin-bottom: 15px; }
        .stat-header { display: flex; justify-content: space-between; margin-bottom: 5px; font-size: 0.9rem; color: #8395a7; }
        .progress-track { background: #222f3e; height: 24px; border-radius: 12px; overflow: hidden; position: relative; }
        .progress-fill { height: 100%; transition: width 0.5s; display: flex; align-items: center; justify-content: flex-end; padding-right: 8px; font-size: 0.8rem; font-weight: bold; color: rgba(0,0,0,0.5); }
        
        .stay-fill { background: var(--danger); width: 0%; }
        .switch-fill { background: var(--success); width: 0%; }
        
        /* 33% and 66% markers */
        .marker { position: absolute; top: 0; bottom: 0; width: 2px; background: rgba(255,255,255,0.3); z-index: 10; }

        /* --- MODAL --- */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.7); display: none; align-items: center; justify-content: center;
            z-index: 2000; backdrop-filter: blur(5px);
        }
        .modal-overlay.active { display: flex; }
        .modal-card {
            background: white; padding: 30px; border-radius: 20px; max-width: 600px; width: 90%;
            color: #2d3436; box-shadow: 0 20px 50px rgba(0,0,0,0.5);
        }
        .modal-card h2 { margin-top: 0; color: #222f3e; border-bottom: 2px solid #eee; padding-bottom: 10px; }
        .modal-card p, .modal-card li { line-height: 1.6; color: #636e72; }
        .highlight { background: #dfe6e9; padding: 2px 6px; border-radius: 4px; font-weight: bold; color: #2d3436; }
    </style>
</head>
<body>

    <h1>Monty Hall Simulator</h1>
    <p class="subtitle">The Math is Counter-Intuitive.</p>

    <div class="message-box" id="msg">Pick a door to start!</div>

    <div class="game-container">
        <div class="door-wrapper" id="door0" onclick="pickDoor(0)">
            <div class="door">1</div>
            <div class="prize" id="prize0">üêê</div>
        </div>
        <div class="door-wrapper" id="door1" onclick="pickDoor(1)">
            <div class="door">2</div>
            <div class="prize" id="prize1">üêê</div>
        </div>
        <div class="door-wrapper" id="door2" onclick="pickDoor(2)">
            <div class="door">3</div>
            <div class="prize" id="prize2">üêê</div>
        </div>
    </div>

    <div class="controls">
        <button id="btnStay" class="choice" onclick="makeDecision(false)">Stay</button>
        <button id="btnSwitch" class="choice" onclick="makeDecision(true)">Switch!</button>
        
        <button id="btnReset" onclick="resetGame()" style="display:none">Play Again</button>
        
        <button class="sim" onclick="simulate(100)">Simulate 100x</button>
        <button class="sim" onclick="simulate(1000)">1000x</button>
        
        <button class="icon-btn" onclick="toggleMute()" id="muteBtn" title="Sound">üîä</button>
        <button class="icon-btn" onclick="toggleModal()" title="Help">?</button>
    </div>

    <div class="stats-grid">
        <div class="stat-row">
            <div class="stat-header">
                <span>STAY Win Rate</span>
                <span id="stayLabel">0/0 (0%)</span>
            </div>
            <div class="progress-track">
                <div class="progress-fill stay-fill" id="stayBar"></div>
                <div class="marker" style="left: 33.3%" title="Theoretical 33%"></div>
            </div>
        </div>

        <div class="stat-row">
            <div class="stat-header">
                <span>SWITCH Win Rate</span>
                <span id="switchLabel">0/0 (0%)</span>
            </div>
            <div class="progress-track">
                <div class="progress-fill switch-fill" id="switchBar"></div>
                <div class="marker" style="left: 66.6%" title="Theoretical 66%"></div>
            </div>
        </div>
        <div style="text-align: center; font-size: 0.8rem; color: #8395a7; margin-top: 10px;">
            White lines mark the mathematical probability (33% vs 66%)
        </div>
    </div>

    <div class="modal-overlay" id="modal">
        <div class="modal-card">
            <h2>Why Switch?</h2>
            
            <p>It feels like a 50/50 choice, but it isn't.</p>
            <ul>
                <li><strong>Start:</strong> You have a 1/3 chance of picking the car. The other doors have a 2/3 chance.</li>
                <li><strong>The Reveal:</strong> Monty opens a door. He <em>cannot</em> pick the car. He effectively consolidates that entire 2/3 chance into the <strong>one remaining door</strong>.</li>
            </ul>
            <p>By switching, you are betting against your original (unlikely) guess.</p>
            <button onclick="toggleModal()" style="width:100%; background: #222f3e;">Got it</button>
        </div>
    </div>

    <script>
        // --- AUDIO SYSTEM ---
        const AudioContext = window.AudioContext || window.webkitAudioContext;
        const audioCtx = new AudioContext();
        let isMuted = false;

        function playSound(type) {
            if (isMuted || audioCtx.state === 'suspended') return;
            const now = audioCtx.currentTime;
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.connect(gain);
            gain.connect(audioCtx.destination);

            if (type === 'win') {
                // Happy Chime
                osc.type = 'triangle';
                osc.frequency.setValueAtTime(523.25, now); // C
                osc.frequency.linearRampToValueAtTime(1046.50, now + 0.1); // High C
                gain.gain.setValueAtTime(0.1, now);
                gain.gain.linearRampToValueAtTime(0.001, now + 0.3);
                osc.start(now);
                osc.stop(now + 0.3);
            } else if (type === 'lose') {
                // Sad slide
                osc.type = 'sawtooth';
                osc.frequency.setValueAtTime(150, now);
                osc.frequency.linearRampToValueAtTime(100, now + 0.4);
                gain.gain.setValueAtTime(0.1, now);
                gain.gain.linearRampToValueAtTime(0.001, now + 0.4);
                osc.start(now);
                osc.stop(now + 0.4);
            } else if (type === 'click') {
                // Woodblock sound
                osc.frequency.setValueAtTime(800, now);
                gain.gain.setValueAtTime(0.05, now);
                gain.gain.exponentialRampToValueAtTime(0.001, now + 0.05);
                osc.start(now);
                osc.stop(now + 0.05);
            }
        }

        function toggleMute() {
            isMuted = !isMuted;
            document.getElementById('muteBtn').innerText = isMuted ? 'üîá' : 'üîä';
            if(!isMuted && audioCtx.state === 'suspended') audioCtx.resume();
        }

        // --- GAME LOGIC ---
        let carLocation = 0;
        let pickedDoor = -1;
        let openedDoor = -1;
        let gameState = 'PICK'; // PICK, DECIDE, REVEAL

        // Stats
        let stayWins = 0, stayTotal = 0;
        let switchWins = 0, switchTotal = 0;

        function init() { resetGame(); }

        function resetGame() {
            gameState = 'PICK';
            pickedDoor = -1;
            openedDoor = -1;
            carLocation = Math.floor(Math.random() * 3);

            document.getElementById('msg').innerText = "Pick a door to start!";
            document.getElementById('msg').style.color = "var(--accent)";
            
            document.getElementById('btnReset').style.display = 'none';
            document.getElementById('btnStay').style.display = 'none';
            document.getElementById('btnSwitch').style.display = 'none';

            for(let i=0; i<3; i++) {
                const dw = document.getElementById(`door${i}`);
                dw.classList.remove('open', 'selected');
                dw.onclick = () => pickDoor(i);
                
                const prize = document.getElementById(`prize${i}`);
                // Reset emoji to Goat/Car
                prize.innerText = (i === carLocation) ? "üöó" : "üêê";
            }
        }

        function pickDoor(doorIndex) {
            if (gameState !== 'PICK') return;
            if (audioCtx.state === 'suspended') audioCtx.resume();
            
            playSound('click');
            pickedDoor = doorIndex;
            document.getElementById(`door${doorIndex}`).classList.add('selected');
            
            // Logic: Monty must open a door that is NOT the car and NOT what you picked
            let options = [0, 1, 2].filter(d => d !== pickedDoor && d !== carLocation);
            openedDoor = options[Math.floor(Math.random() * options.length)];

            // Slight delay for drama
            setTimeout(() => {
                document.getElementById(`door${openedDoor}`).classList.add('open');
                gameState = 'DECIDE';
                document.getElementById('msg').innerText = `Monty opens Door ${openedDoor+1}. Switch or Stay?`;
                document.getElementById('btnStay').style.display = 'block';
                document.getElementById('btnSwitch').style.display = 'block';
            }, 400);
        }

        function makeDecision(didSwitch) {
            if (gameState !== 'DECIDE') return;

            // Determine final door
            let finalDoor = pickedDoor;
            if (didSwitch) {
                finalDoor = [0, 1, 2].find(d => d !== pickedDoor && d !== openedDoor);
            }

            // Reveal all
            for(let i=0; i<3; i++) document.getElementById(`door${i}`).classList.add('open');

            const win = (finalDoor === carLocation);
            
            if (win) {
                document.getElementById('msg').innerText = didSwitch ? "SWITCHED & WON! üöó" : "STAYED & WON! üöó";
                document.getElementById('msg').style.color = "#1dd1a1";
                playSound('win');
            } else {
                document.getElementById('msg').innerText = "GOT THE GOAT üêê";
                document.getElementById('msg').style.color = "#ff6b6b";
                playSound('lose');
            }

            // Track stats
            if (didSwitch) {
                switchTotal++;
                if (win) switchWins++;
            } else {
                stayTotal++;
                if (win) stayWins++;
            }
            updateStatsUI();

            document.getElementById('btnStay').style.display = 'none';
            document.getElementById('btnSwitch').style.display = 'none';
            document.getElementById('btnReset').style.display = 'block';
            gameState = 'REVEAL';
        }

        // --- BULK SIMULATION ---
        function simulate(runs) {
            // Run logic purely in JS variables for speed
            let sWins = 0; // Switch wins
            let kWins = 0; // Keep/Stay wins
            
            for(let i=0; i<runs; i++) {
                const car = Math.floor(Math.random() * 3);
                const pick = Math.floor(Math.random() * 3);
                
                // If I STAY, I only win if I picked the car initially
                if (pick === car) kWins++;
                
                // If I SWITCH, I win if I picked a GOAT initially (because Monty removes the other goat, forcing me to the car)
                else sWins++;
            }

            stayWins += kWins;
            stayTotal += runs;
            switchWins += sWins;
            switchTotal += runs;
            
            updateStatsUI();
            resetGame(); // Reset UI state so it doesn't look stuck
            document.getElementById('msg').innerText = `Simulated ${runs} rounds!`;
        }

        function updateStatsUI() {
            const stayPct = stayTotal === 0 ? 0 : ((stayWins/stayTotal)*100).toFixed(1);
            const switchPct = switchTotal === 0 ? 0 : ((switchWins/switchTotal)*100).toFixed(1);

            // Update Text
            document.getElementById('stayLabel').innerText = `${stayWins}/${stayTotal} (${stayPct}%)`;
            document.getElementById('switchLabel').innerText = `${switchWins}/${switchTotal} (${switchPct}%)`;
            
            // Update Bars
            document.getElementById('stayBar').style.width = stayPct + "%";
            document.getElementById('switchBar').style.width = switchPct + "%";
        }

        function toggleModal() {
            document.getElementById('modal').classList.toggle('active');
        }

        // Init
        init();
    </script>
</body>
</html>
