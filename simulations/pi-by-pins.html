<script>
        // --- AUDIO ENGINE ---
        const AudioContext = window.AudioContext || window.webkitAudioContext;
        const audioCtx = new AudioContext();
        let isMuted = false;

        function playNeedleSound() {
            if (isMuted || audioCtx.state === 'suspended') return;
            
            // Only play sound if speed is low (prevent audio glitching/noise)
            const speed = parseInt(document.getElementById('speedRange').value);
            if (speed > 5) return; 

            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            
            osc.connect(gain);
            gain.connect(audioCtx.destination);

            // Synthesize a "clink" (high frequency, fast decay)
            osc.type = 'sine';
            osc.frequency.setValueAtTime(800 + Math.random() * 400, audioCtx.currentTime);
            osc.frequency.exponentialRampToValueAtTime(100, audioCtx.currentTime + 0.05);

            gain.gain.setValueAtTime(0.05, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.05);

            osc.start();
            osc.stop(audioCtx.currentTime + 0.05);
        }

        function toggleMute() {
            isMuted = !isMuted;
            const btn = document.getElementById('muteBtn');
            btn.innerText = isMuted ? "ðŸ”‡" : "ðŸ”Š";
            if (!isMuted && audioCtx.state === 'suspended') audioCtx.resume();
        }

        // --- UPDATED DROP LOGIC ---
        function dropNeedle() {
            // Wake up audio context on first interaction
            if (audioCtx.state === 'suspended') audioCtx.resume();

            const x = Math.random() * width;
            const y = Math.random() * height;
            const angle = Math.random() * Math.PI;

            const x1 = x - (needleLength / 2) * Math.cos(angle);
            const y1 = y - (needleLength / 2) * Math.sin(angle);
            const x2 = x + (needleLength / 2) * Math.cos(angle);
            const y2 = y + (needleLength / 2) * Math.sin(angle);

            const lineIndex1 = Math.floor(y1 / lineSpacing);
            const lineIndex2 = Math.floor(y2 / lineSpacing);
            const isCross = lineIndex1 !== lineIndex2;

            if (isCross) crosses++;
            total++;

            needles.push({ x1, y1, x2, y2, crosses: isCross });
            if (needles.length > 2000) needles.shift();

            // Play the sound
            playNeedleSound();

            if (!isRunning) draw(); 
            updateStats();
        }

        // --- UPDATED MODAL TEXT ---
        // Inside your HTML, change the <h3> and <p> tags to:
        /* <h3>Estimated Ï€</h3>
           <p>Ï€ â‰ˆ 2 Ã— (Total / Crosses)</p>
        */
    </script>

    <div class="controls">
        <button id="muteBtn" onclick="toggleMute()" style="background:transparent; font-size:1.2rem; min-width:40px; padding:0;">ðŸ”Š</button>
    </div>
