<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dice Distribution</title>
    <link rel="icon" href="../favicon.ico">
    <style>
        :root {
            --bg-color: #222f3e;
            --accent: #a55eea; /* Purple accent */
            --bar-color: #a55eea;
            --text-color: #c8d6e5;
            --container-bg: #151b23;
            --info: #54a0ff;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }

        h1 { margin-bottom: 5px; font-weight: 300; letter-spacing: 2px; text-transform: uppercase; color: #fff; }
        p.subtitle { color: #8395a7; margin-top: 0; margin-bottom: 25px; }

        .controls {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            background: rgba(0,0,0,0.2);
            padding: 10px 20px;
            border-radius: 50px;
            align-items: center;
            flex-wrap: wrap;
            justify-content: center;
        }

        button {
            padding: 10px 20px;
            border-radius: 25px;
            border: none;
            font-size: 0.9rem;
            font-weight: 700;
            cursor: pointer;
            transition: transform 0.1s;
            background: #576574;
            color: white;
        }
        
        button:active { transform: scale(0.95); }
        button.primary { background-color: var(--accent); color: white; }
        
        /* Sliders */
        .slide-group {
            display: flex; flex-direction: column; align-items: center; margin: 0 10px;
        }
        .slide-group label { font-size: 0.7rem; color: #8395a7; font-weight: bold; margin-bottom: 5px; letter-spacing: 1px;}
        input[type=range] { accent-color: var(--accent); cursor: pointer; }

        /* Chart */
        .chart-container {
            width: 100%; max-width: 800px;
            height: 400px;
            background: var(--container-bg);
            border: 2px solid #576574;
            border-radius: 12px;
            position: relative;
            margin-bottom: 20px;
            box-shadow: inset 0 0 50px rgba(0,0,0,0.5);
            padding: 10px;
            box-sizing: border-box;
        }
        canvas { display: block; width: 100%; height: 100%; }

        /* Axis Labels */
        .axis-title {
            position: absolute;
            bottom: 10px;
            left: 0;
            width: 100%;
            text-align: center;
            color: #8395a7;
            font-size: 0.9rem;
            font-weight: bold;
            pointer-events: none;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .stats { font-family: monospace; color: var(--accent); font-size: 1.2rem; margin-top: 10px;}

        /* Modal */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.6);
            display: flex; align-items: center; justify-content: center;
            z-index: 1000; opacity: 0; pointer-events: none;
            transition: opacity 0.3s; backdrop-filter: blur(5px);
        }
        .modal-overlay.active { opacity: 1; pointer-events: auto; }
        .modal-card {
            background: white; padding: 30px; border-radius: 20px;
            max-width: 550px; width: 90%; color: #2d3436;
            box-shadow: 0 20px 50px rgba(0,0,0,0.5);
            transform: translateY(20px); transition: transform 0.3s;
        }
        .modal-overlay.active .modal-card { transform: translateY(0); }
        .modal-card h2 { margin-top: 0; color: #222f3e; border-bottom: 2px solid #f0f0f0; padding-bottom: 10px; }
        .modal-card p { line-height: 1.6; color: #636e72; }
        .close-btn { margin-top: 20px; width: 100%; background: #222f3e; }
    </style>
</head>
<body>

    <h1>Dice Distribution</h1>
    <p class="subtitle">From Flat to Bell Curve</p>

    <div class="chart-container">
        <canvas id="chart"></canvas>
        <div id="xAxisLabel" class="axis-title">Sum of Dice (2 - 12)</div>
    </div>

    <div class="stats">Total Rolls: <span id="totalEl" style="color: white;">0</span></div>

    <div class="controls">
        <button onclick="rollOnce()">+1 Roll</button>
        <button id="btnStart" class="primary" onclick="toggleSim()">Run Auto</button>
        
        <div class="slide-group">
            <label>NUMBER OF DICE: <span id="diceCountVal" style="color:white">2</span></label>
            <input type="range" id="diceRange" min="1" max="20" value="2" oninput="updateConfig()">
        </div>

        <div class="slide-group">
            <label>SPEED</label>
            <input type="range" id="speedRange" min="1" max="100" value="10">
        </div>

        <button onclick="resetSim()">Reset</button>
        <button style="background: var(--info); border-radius: 50%; width: 36px; padding:0;" onclick="toggleModal()">?</button>
    </div>

    <div class="modal-overlay" id="modal">
        <div class="modal-card">
            <h2>The Central Limit Theorem</h2>
            <p>This simulation proves a fundamental rule of statistics:</p>
            <p>No matter what random thing you measure, if you add enough of them together, the result always forms a <strong>Bell Curve</strong>.</p>
            
            <h3>Try this:</h3>
            <ul>
                <li><strong>1 Die:</strong> Flat shape (Uniform Distribution).</li>
                <li><strong>2 Dice:</strong> Pyramid shape (Triangular).</li>
                <li><strong>10+ Dice:</strong> Perfect Bell Curve (Normal Distribution).</li>
            </ul>
            <button class="close-btn" onclick="toggleModal()">Got it!</button>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('chart');
        const ctx = canvas.getContext('2d');
        const totalEl = document.getElementById('totalEl');
        const diceRange = document.getElementById('diceRange');
        const diceCountVal = document.getElementById('diceCountVal');
        const speedRange = document.getElementById('speedRange');
        const xAxisLabel = document.getElementById('xAxisLabel');

        let isRunning = false;
        let animationFrame;
        
        // Config
        let numDice = 2;
        let totalRolls = 0;
        let counts = {};

        function init() {
            const dpr = window.devicePixelRatio || 1;
            const rect = canvas.getBoundingClientRect();
            canvas.width = rect.width * dpr;
            canvas.height = rect.height * dpr;
            ctx.scale(dpr, dpr);
            
            resetSim();
        }

        function updateConfig() {
            numDice = parseInt(diceRange.value);
            diceCountVal.innerText = numDice;
            resetSim(); 
        }

        function resetSim() {
            isRunning = false;
            cancelAnimationFrame(animationFrame);
            document.getElementById('btnStart').innerText = "Run Auto";
            
            totalRolls = 0;
            totalEl.innerText = "0";
            
            // Setup Counts
            counts = {};
            const minSum = numDice;
            const maxSum = numDice * 6;
            
            xAxisLabel.innerText = `Sum of Dice (${minSum} - ${maxSum})`;

            for (let i = minSum; i <= maxSum; i++) {
                counts[i] = 0;
            }

            drawChart();
        }

        function rollOnce() {
            let sum = 0;
            for(let i=0; i<numDice; i++) {
                sum += Math.floor(Math.random() * 6) + 1;
            }
            
            counts[sum]++;
            totalRolls++;
            
            if (!isRunning) {
                totalEl.innerText = totalRolls.toLocaleString();
                drawChart();
            }
        }

        function drawChart() {
            const width = canvas.width / (window.devicePixelRatio || 1);
            const height = canvas.height / (window.devicePixelRatio || 1);
            
            ctx.clearRect(0, 0, width, height);

            let maxCount = 0;
            for (let key in counts) {
                if (counts[key] > maxCount) maxCount = counts[key];
            }
            if (maxCount === 0) maxCount = 1;

            const minSum = numDice;
            const maxSum = numDice * 6;
            const numBars = maxSum - minSum + 1;
            
            // Layout Configuration
            const paddingBottom = 40; 
            const paddingLeft = 50; // Extra space for Y-Axis numbers
            const paddingRight = 20;
            const paddingTop = 20;

            const chartW = width - (paddingLeft + paddingRight);
            const chartH = height - (paddingBottom + paddingTop);
            
            // --- DRAW Y-AXIS & GRID ---
            ctx.textAlign = "right";
            ctx.textBaseline = "middle";
            ctx.font = "11px monospace";
            
            // Draw 5 grid lines and labels
            const steps = 5;
            for(let i = 0; i <= steps; i++) {
                const ratio = i / steps;
                const value = Math.round(maxCount * ratio);
                const yPos = (height - paddingBottom) - (ratio * chartH);

                // Grid line
                ctx.beginPath();
                ctx.strokeStyle = "rgba(255, 255, 255, 0.1)"; // Faint line
                ctx.moveTo(paddingLeft, yPos);
                ctx.lineTo(width - paddingRight, yPos);
                ctx.stroke();

                // Number Label
                ctx.fillStyle = "#8395a7";
                ctx.fillText(value, paddingLeft - 10, yPos);
            }

            // --- DRAW BARS ---
            const barWidth = (chartW / numBars) * 0.8;
            const gap = (chartW / numBars) * 0.2;

            for (let i = 0; i < numBars; i++) {
                const sumValue = minSum + i;
                const count = counts[sumValue];
                
                const barHeight = (count / maxCount) * chartH;
                
                const x = paddingLeft + (i * (barWidth + gap)) + (gap/2);
                const y = height - paddingBottom - barHeight;

                // Gradient
                const gradient = ctx.createLinearGradient(x, y, x, height - paddingBottom);
                gradient.addColorStop(0, "#a55eea");
                gradient.addColorStop(1, "rgba(165, 94, 234, 0.2)");
                
                ctx.fillStyle = gradient;
                ctx.beginPath();
                ctx.roundRect(x, y, barWidth, barHeight, [4, 4, 0, 0]);
                ctx.fill();

                // Draw number labels on bars ONLY if bars are wide enough
                if (barWidth > 25) {
                    ctx.fillStyle = "#fff";
                    ctx.font = "bold 10px sans-serif";
                    ctx.textAlign = "center";
                    ctx.fillText(sumValue, x + barWidth/2, height - paddingBottom + 15);
                }
            }
        }

        function toggleSim() {
            if (isRunning) {
                isRunning = false;
                document.getElementById('btnStart').innerText = "Run Auto";
            } else {
                isRunning = true;
                document.getElementById('btnStart').innerText = "Pause";
                loop();
            }
        }

        function loop() {
            if (!isRunning) return;

            const speed = parseInt(speedRange.value);
            const rollsPerFrame = Math.floor(Math.pow(speed, 1.3));

            for(let i=0; i<rollsPerFrame; i++) {
                rollOnce();
            }
            
            totalEl.innerText = totalRolls.toLocaleString();
            drawChart();
            animationFrame = requestAnimationFrame(loop);
        }

        function toggleModal() { document.getElementById('modal').classList.toggle('active'); }
        document.getElementById('modal').addEventListener('click', function(e) {
            if (e.target === this) toggleModal();
        });

        window.addEventListener('resize', init);
        init();

    </script>
</body>
</html>
